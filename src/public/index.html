<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BDD AI Showcase - Admissions</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { text-align: left; padding: 0.5rem; border-bottom: 1px solid #ddd; }
    th { background: #f5f5f5; }
    button { padding: 0.25rem 0.5rem; cursor: pointer; }
    .actions { white-space: nowrap; }
    .form-section { margin: 1rem 0; padding: 1rem; border: 1px solid #ddd; display: none; }
    .form-section.visible { display: block; }
    .form-section label { display: block; margin: 0.5rem 0 0.25rem; }
    .form-section input, .form-section select { width: 100%; padding: 0.5rem; box-sizing: border-box; }
    .form-section button { margin-top: 1rem; }
    .tabs { margin: 1.5rem 0 1rem; border-bottom: 2px solid #ddd; }
    .tab { padding: 0.5rem 1rem; border: none; background: none; cursor: pointer; font-size: 1rem; border-bottom: 2px solid transparent; margin-bottom: -2px; }
    .tab.active { border-bottom-color: #007bff; font-weight: bold; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>
</head>
<body>
  <h1>Admissions Portal</h1>
  <p>Welcome to the BDD AI Showcase application.</p>

  <div class="tabs">
    <button class="tab active" data-tab="organizations">Organizations</button>
    <button class="tab" data-tab="educations">Educations</button>
    <button class="tab" data-tab="admissions">Admissions</button>
  </div>

  <!-- Organizations Tab -->
  <div id="organizations-tab" class="tab-content active">
    <button id="add-org-btn">Add Organization</button>

    <div id="org-form" class="form-section">
      <h3 id="org-form-title">Add Organization</h3>
      <input type="hidden" id="org-id">
      <label for="org-name">Name</label>
      <input type="text" id="org-name" required>
      <label for="org-level">Level</label>
      <select id="org-level">
        <option value="UNIVERSITY">University</option>
        <option value="COLLEGE">College</option>
        <option value="HIGH_SCHOOL">High School</option>
      </select>
      <label for="org-category">Category</label>
      <select id="org-category">
        <option value="LIBERAL_ARTS">Liberal Arts</option>
        <option value="TECHNICAL">Technical</option>
        <option value="PROFESSIONAL">Professional</option>
        <option value="RESEARCH">Research</option>
        <option value="VOCATIONAL">Vocational</option>
      </select>
      <label for="org-description">Description (optional)</label>
      <input type="text" id="org-description">
      <button id="submit-org-btn">Save</button>
      <button type="button" id="cancel-org-btn">Cancel</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Level</th>
          <th>Category</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="organizations-list">
        <tr><td colspan="4">Loading...</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Educations Tab -->
  <div id="educations-tab" class="tab-content">
    <button id="add-education-btn">Add Education</button>

    <div id="education-form" class="form-section">
      <h3 id="education-form-title">Add Education</h3>
      <input type="hidden" id="education-id">
      <label for="education-name">Name</label>
      <input type="text" id="education-name" required>
      <label for="education-code">Code</label>
      <input type="text" id="education-code" required>
      <label for="education-level">Level</label>
      <select id="education-level">
        <option value="BACHELOR">Bachelor</option>
        <option value="MASTER">Master</option>
        <option value="DOCTORATE">Doctorate</option>
        <option value="CERTIFICATE">Certificate</option>
      </select>
      <label for="education-organization">Organization</label>
      <select id="education-organization" required>
        <option value="">Select an organization...</option>
      </select>
      <label for="education-description">Description (optional)</label>
      <input type="text" id="education-description">
      <button id="submit-education-btn">Save</button>
      <button type="button" id="cancel-education-btn">Cancel</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Code</th>
          <th>Level</th>
          <th>Organization</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="educations-list">
        <tr><td colspan="5">Loading...</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Admissions Tab -->
  <div id="admissions-tab" class="tab-content">
    <button id="add-admission-btn">Add Admission</button>

    <div id="admission-form" class="form-section">
      <h3 id="admission-form-title">Add Admission</h3>
      <input type="hidden" id="admission-id">
      <label for="admission-name">Name</label>
      <input type="text" id="admission-name" required>
      <label for="admission-opens">Application Opens</label>
      <input type="date" id="admission-opens" required>
      <label for="admission-deadline">Application Deadline</label>
      <input type="date" id="admission-deadline" required>
      <label for="admission-organization">Organization</label>
      <select id="admission-organization" required>
        <option value="">Select an organization...</option>
      </select>
      <label for="admission-description">Description (optional)</label>
      <input type="text" id="admission-description">
      <button id="submit-admission-btn">Save</button>
      <button type="button" id="cancel-admission-btn">Cancel</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Opens</th>
          <th>Deadline</th>
          <th>Organization</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="admissions-list">
        <tr><td colspan="5">Loading...</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    let organizations = [];
    let educations = [];
    let admissions = [];

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
      });
    });

    // Organizations
    async function loadOrganizations() {
      const tbody = document.getElementById('organizations-list');
      try {
        const response = await fetch('/api/organizations');
        organizations = await response.json();

        if (organizations.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4">No organizations found.</td></tr>';
        } else {
          tbody.innerHTML = organizations.map(org => `
            <tr data-id="${org.id}">
              <td>${org.name}</td>
              <td>${org.level}</td>
              <td>${org.category}</td>
              <td class="actions">
                <button onclick="editOrganization('${org.id}')">Edit</button>
                <button onclick="deleteOrganization('${org.id}')">Delete</button>
              </td>
            </tr>
          `).join('');
        }

        // Update organization dropdowns
        updateOrgDropdowns();
      } catch (error) {
        tbody.innerHTML = '<tr><td colspan="4">Error loading organizations.</td></tr>';
      }
    }

    function updateOrgDropdowns() {
      const eduSelect = document.getElementById('education-organization');
      const admSelect = document.getElementById('admission-organization');
      const eduValue = eduSelect.value;
      const admValue = admSelect.value;

      const options = '<option value="">Select an organization...</option>' +
        organizations.map(org => `<option value="${org.id}">${org.name}</option>`).join('');

      eduSelect.innerHTML = options;
      admSelect.innerHTML = options;

      if (eduValue) eduSelect.value = eduValue;
      if (admValue) admSelect.value = admValue;
    }

    function showOrgForm(title = 'Add Organization') {
      document.getElementById('org-form-title').textContent = title;
      document.getElementById('org-form').classList.add('visible');
    }

    function hideOrgForm() {
      document.getElementById('org-form').classList.remove('visible');
      document.getElementById('org-id').value = '';
      document.getElementById('org-name').value = '';
      document.getElementById('org-level').value = 'UNIVERSITY';
      document.getElementById('org-category').value = 'LIBERAL_ARTS';
      document.getElementById('org-description').value = '';
    }

    document.getElementById('add-org-btn').addEventListener('click', () => {
      hideOrgForm();
      showOrgForm('Add Organization');
    });

    document.getElementById('cancel-org-btn').addEventListener('click', hideOrgForm);

    document.getElementById('submit-org-btn').addEventListener('click', async () => {
      const id = document.getElementById('org-id').value;
      const data = {
        name: document.getElementById('org-name').value,
        level: document.getElementById('org-level').value,
        category: document.getElementById('org-category').value,
        description: document.getElementById('org-description').value || null,
      };

      if (id) {
        await fetch(`/api/organizations/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
      } else {
        await fetch('/api/organizations', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
      }

      hideOrgForm();
      loadOrganizations();
    });

    function editOrganization(id) {
      const org = organizations.find(o => o.id === id);
      if (!org) return;

      document.getElementById('org-id').value = org.id;
      document.getElementById('org-name').value = org.name;
      document.getElementById('org-level').value = org.level;
      document.getElementById('org-category').value = org.category;
      document.getElementById('org-description').value = org.description || '';
      showOrgForm('Edit Organization');
    }

    async function deleteOrganization(id) {
      await fetch(`/api/organizations/${id}`, { method: 'DELETE' });
      loadOrganizations();
    }

    // Educations
    async function loadEducations() {
      const tbody = document.getElementById('educations-list');
      try {
        const response = await fetch('/api/educations');
        educations = await response.json();

        if (educations.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5">No educations found.</td></tr>';
          return;
        }

        tbody.innerHTML = educations.map(edu => {
          const org = organizations.find(o => o.id === edu.organizationId);
          return `
            <tr data-id="${edu.id}">
              <td>${edu.name}</td>
              <td>${edu.code}</td>
              <td>${edu.level}</td>
              <td>${org ? org.name : 'Unknown'}</td>
              <td class="actions">
                <button onclick="editEducation('${edu.id}')">Edit</button>
                <button onclick="deleteEducation('${edu.id}')">Delete</button>
              </td>
            </tr>
          `;
        }).join('');
      } catch (error) {
        tbody.innerHTML = '<tr><td colspan="5">Error loading educations.</td></tr>';
      }
    }

    function showEducationForm(title = 'Add Education') {
      document.getElementById('education-form-title').textContent = title;
      document.getElementById('education-form').classList.add('visible');
    }

    function hideEducationForm() {
      document.getElementById('education-form').classList.remove('visible');
      document.getElementById('education-id').value = '';
      document.getElementById('education-name').value = '';
      document.getElementById('education-code').value = '';
      document.getElementById('education-level').value = 'BACHELOR';
      document.getElementById('education-organization').value = '';
      document.getElementById('education-description').value = '';
    }

    document.getElementById('add-education-btn').addEventListener('click', () => {
      hideEducationForm();
      showEducationForm('Add Education');
    });

    document.getElementById('cancel-education-btn').addEventListener('click', hideEducationForm);

    document.getElementById('submit-education-btn').addEventListener('click', async () => {
      const id = document.getElementById('education-id').value;
      const data = {
        name: document.getElementById('education-name').value,
        code: document.getElementById('education-code').value,
        level: document.getElementById('education-level').value,
        organizationId: document.getElementById('education-organization').value,
        description: document.getElementById('education-description').value || null,
      };

      if (id) {
        await fetch(`/api/educations/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
      } else {
        await fetch('/api/educations', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
      }

      hideEducationForm();
      loadEducations();
    });

    function editEducation(id) {
      const edu = educations.find(e => e.id === id);
      if (!edu) return;

      document.getElementById('education-id').value = edu.id;
      document.getElementById('education-name').value = edu.name;
      document.getElementById('education-code').value = edu.code;
      document.getElementById('education-level').value = edu.level;
      document.getElementById('education-organization').value = edu.organizationId;
      document.getElementById('education-description').value = edu.description || '';
      showEducationForm('Edit Education');
    }

    async function deleteEducation(id) {
      await fetch(`/api/educations/${id}`, { method: 'DELETE' });
      loadEducations();
    }

    // Admissions
    async function loadAdmissions() {
      const tbody = document.getElementById('admissions-list');
      try {
        const response = await fetch('/api/admissions');
        admissions = await response.json();

        if (admissions.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5">No admissions found.</td></tr>';
          return;
        }

        tbody.innerHTML = admissions.map(adm => {
          const org = organizations.find(o => o.id === adm.organizationId);
          const opens = adm.applicationOpens ? adm.applicationOpens.split('T')[0] : '';
          const deadline = adm.applicationDeadline ? adm.applicationDeadline.split('T')[0] : '';
          return `
            <tr data-id="${adm.id}">
              <td>${adm.name}</td>
              <td>${opens}</td>
              <td>${deadline}</td>
              <td>${org ? org.name : 'Unknown'}</td>
              <td class="actions">
                <button onclick="editAdmission('${adm.id}')">Edit</button>
                <button onclick="deleteAdmission('${adm.id}')">Delete</button>
              </td>
            </tr>
          `;
        }).join('');
      } catch (error) {
        tbody.innerHTML = '<tr><td colspan="5">Error loading admissions.</td></tr>';
      }
    }

    function showAdmissionForm(title = 'Add Admission') {
      document.getElementById('admission-form-title').textContent = title;
      document.getElementById('admission-form').classList.add('visible');
    }

    function hideAdmissionForm() {
      document.getElementById('admission-form').classList.remove('visible');
      document.getElementById('admission-id').value = '';
      document.getElementById('admission-name').value = '';
      document.getElementById('admission-opens').value = '';
      document.getElementById('admission-deadline').value = '';
      document.getElementById('admission-organization').value = '';
      document.getElementById('admission-description').value = '';
    }

    document.getElementById('add-admission-btn').addEventListener('click', () => {
      hideAdmissionForm();
      showAdmissionForm('Add Admission');
    });

    document.getElementById('cancel-admission-btn').addEventListener('click', hideAdmissionForm);

    document.getElementById('submit-admission-btn').addEventListener('click', async () => {
      const id = document.getElementById('admission-id').value;
      const opens = document.getElementById('admission-opens').value;
      const deadline = document.getElementById('admission-deadline').value;
      const data = {
        name: document.getElementById('admission-name').value,
        applicationOpens: opens ? `${opens}T00:00:00Z` : null,
        applicationDeadline: deadline ? `${deadline}T23:59:59Z` : null,
        organizationId: document.getElementById('admission-organization').value,
        description: document.getElementById('admission-description').value || null,
      };

      if (id) {
        await fetch(`/api/admissions/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
      } else {
        await fetch('/api/admissions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
      }

      hideAdmissionForm();
      loadAdmissions();
    });

    function editAdmission(id) {
      const adm = admissions.find(a => a.id === id);
      if (!adm) return;

      document.getElementById('admission-id').value = adm.id;
      document.getElementById('admission-name').value = adm.name;
      document.getElementById('admission-opens').value = adm.applicationOpens ? adm.applicationOpens.split('T')[0] : '';
      document.getElementById('admission-deadline').value = adm.applicationDeadline ? adm.applicationDeadline.split('T')[0] : '';
      document.getElementById('admission-organization').value = adm.organizationId;
      document.getElementById('admission-description').value = adm.description || '';
      showAdmissionForm('Edit Admission');
    }

    async function deleteAdmission(id) {
      await fetch(`/api/admissions/${id}`, { method: 'DELETE' });
      loadAdmissions();
    }

    // Initialize
    async function init() {
      await loadOrganizations();
      await loadEducations();
      await loadAdmissions();
    }

    init();
  </script>
</body>
</html>
